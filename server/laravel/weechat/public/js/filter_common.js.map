{"version":3,"sources":["filter.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"filter_common.js","sourcesContent":["/**\r\n * Created by nguyen.khac.tung on 10/17/2017.\r\n */\r\n\r\n//filterClear(); and fillFilterToForm() will call in library page and scenario edit page;\r\n\r\nvar _variable_custom = ['current_time'];\r\nvar _sperate_text = '/';\r\n\r\ncheckEmptyFilterItem();\r\n//add filter item\r\n$(document).on('click', '#btn_filter_add', function(evt) {\r\n    var filter_index = addFilterItem();\r\n    getFilterVariableData(filter_index);\r\n});\r\n\r\n//update data follow variable\r\n$(document).on('change', '.filter_item .filter_variable', function(evt) {\r\n    var filter_index = $(this).parents('.filter_item').index();\r\n    getFilterVariableData(filter_index);\r\n});\r\n//change value\r\n$(document).on('change', '.filter_item .filter_value_select', function(evt) {\r\n    getNumberUser();\r\n});\r\n//change compare\r\n$(document).on('change', '.filter_item .filter_operator', function(evt) {\r\n    getNumberUser();\r\n});\r\n// change value custom variable\r\n$(document).on('input', '.filter_item input.filter_value_text', function(evt) {\r\n    getNumberUser();\r\n});\r\n// change value option filter\r\n$(document).on('change', '.filter_item .filter_option', function(evt) {\r\n    if ($(this).val() == 'or'){\r\n        $(this).parents('.filter_item').find('.filter_scenario_value .filter_scenario').removeClass('hidden').attr('disabled', null);\r\n    }else {\r\n        $(this).parents('.filter_item').find('.filter_scenario_value .filter_scenario').addClass('hidden').attr('disabled', 'disabled');\r\n    }\r\n});\r\n//remove filter item\r\n$(document).on('click', '.filter_item .filter_btn_delete', function(evt) {\r\n    $(this).parents('.filter_item').remove();\r\n    indexParam();\r\n    checkEmptyFilterItem();\r\n    if($('.filter_contain .filter_item').length >= 1) {\r\n        getNumberUser();\r\n    }\r\n    //scenario create\r\n    var parent = $('.filter_contain .filter_item').first();\r\n    parent.find('.select_option .filter_option').addClass('hidden').attr('disabled', 'disabled');\r\n    parent.find('.filter_scenario_value .filter_scenario').removeClass('hidden').attr('disabled', null);\r\n})\r\n\r\n;//remove filter item\r\n$(document).on('change', '.filter_item .filter_date_box select', function(evt) {\r\n    var filter_index = $(this).parents('.filter_item').index();\r\n    getDateTypeValue(filter_index);\r\n});\r\n\r\n/**\r\n * ajax get operator and value follow variable\r\n */\r\nfunction getFilterVariableData(filter_index, async) {\r\n    var filter_item     = $('.filter_contain .filter_item').eq(filter_index);\r\n    var variable_code   = filter_item.find('.filter_variable').val();\r\n    if(filter_item != void 0 && filter_item != '' && variable_code != void 0) {\r\n        var csrf_token  = $('.template_filter .csrf_token').val();\r\n        var url = $('.template_filter .filter_variable_data_url').val();\r\n\r\n        filter_item.find('select.filter_operator, select.filter_value_select, input.filter_value_text, select.filter_value_minute, select.filter_value_hour').attr('style', 'background: #f1f2f7');\r\n        var value_text      = filter_item.find('input.filter_value_text'),\r\n            value_select    = filter_item.find('select.filter_value_select'),\r\n            filter_date_box = filter_item.find('.filter_date_box');\r\n\r\n        $.ajax({\r\n            url: url,\r\n            type: 'POST',\r\n            data: {\r\n                \"_token\": csrf_token,\r\n                \"variable_code\": variable_code,\r\n            },\r\n            async: (async != void 0) ? async : true,\r\n            success: function(data) {\r\n                if(data != void 0){\r\n                    //fill operator option follow variable\r\n                    if(data.filter_operator_list != void 0) {\r\n                        var operator_select = filter_item.find('select.filter_operator');\r\n                        operator_select.find('option').remove();\r\n\r\n                        Object.keys(data.filter_operator_list).forEach(function(key) {\r\n                            var option_item = '<option value=\"' + key + '\">' + data.filter_operator_list[key] + '</option>';\r\n                            operator_select.append(option_item);\r\n                        });\r\n                    }\r\n\r\n                    //disable and remove select type\r\n                    value_select.addClass('hidden').attr('disabled', 'disabled');\r\n                    filter_date_box.addClass('hidden');\r\n                    //use text type\r\n                    value_text.removeClass('hidden').attr('disabled', null);\r\n\r\n                    //fill value option follow variable\r\n                    //if is _variable_custom then custom value for each variable\r\n                    if(_variable_custom.indexOf(variable_code) < 0) {\r\n                        //If option is not empty then use select type\r\n                        if(data.filter_variable_value_list != void 0 && Object.keys(data.filter_variable_value_list).length) {\r\n                            //disable and remove text type\r\n                            value_text.addClass('hidden').attr('disabled', 'disabled');\r\n                            //use select type\r\n                            value_select.removeClass('hidden').attr('disabled', null).find('option').remove();\r\n\r\n                            Object.keys(data.filter_variable_value_list).forEach(function(key) {\r\n                                var option_item = '<option value=\"' + key + '\">' + data.filter_variable_value_list[key] + '</option>';\r\n                                value_select.append(option_item);\r\n                            });\r\n                        }\r\n                    } else {\r\n                        custom_variable_value(variable_code);\r\n                    }\r\n\r\n                    getNumberUser();\r\n                }\r\n            },\r\n            error: function(result){\r\n                var response = result.responseJSON;\r\n                if(response.msg != void 0 && response.msg != '') {\r\n                    setMesssage(response.msg, 1, filter_item.parents('.modal-body').find('.box_message'));\r\n                }\r\n            },\r\n            complete: function () {\r\n                filter_item.find('select.filter_operator, select.filter_value_select, input.filter_value_text, select.filter_value_minute, select.filter_value_hour').attr('style', null);\r\n            }\r\n        });\r\n    }\r\n\r\n    //custom value for variable_custom\r\n    function custom_variable_value(variable_code) {\r\n        if(_variable_custom.indexOf(variable_code) >= 0) {\r\n            switch (variable_code) {\r\n                case 'current_time':\r\n                    //hidden text type and select type, date value will set to text type input\r\n                    value_select.addClass('hidden');\r\n                    value_text.addClass('hidden');\r\n                    filter_date_box.removeClass('hidden');\r\n\r\n                    getDateTypeValue(filter_index);\r\n                    break;\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nfunction indexParam() {\r\n    $('.filter_contain .filter_item').each(function (i, e) {\r\n        var prefix_name = 'filter['+ i +']';\r\n\r\n        $(this).find('select.filter_option').attr('name', prefix_name +'[option]');\r\n        $(this).find('select.filter_variable').attr('name', prefix_name +'[condition]');\r\n        $(this).find('select.filter_operator').attr('name', prefix_name+ '[compare]');\r\n        $(this).find('input.filter_value_text').attr('name', prefix_name+ '[value]');\r\n        $(this).find('select.filter_value_select').attr('name', prefix_name+ '[value]');\r\n        $(this).find('select.filter_scenario').attr('name', prefix_name+ '[scenario_id]');\r\n    });\r\n}\r\n\r\n//check to show hide filter status\r\nfunction checkEmptyFilterItem() {\r\n    if($('.filter_contain .filter_item').length) {\r\n        $('.filter_status').addClass('hidden');\r\n        //show number user push notification\r\n        $('.number_user').removeClass('hidden');\r\n    } else {\r\n        $('.filter_status').removeClass('hidden');\r\n        //hide number user push notification\r\n        $('.number_user').addClass('hidden');\r\n    }\r\n}\r\n\r\n//clear filter\r\nfunction filterClear() {\r\n    $('.filter_contain .filter_item').remove();\r\n    checkEmptyFilterItem();\r\n}\r\n\r\n//add filter item\r\nfunction addFilterItem() {\r\n    var filter_clone = $('.template_filter .filter_item').clone();\r\n    $('.filter_contain').append(filter_clone);\r\n\r\n    var filter_index = $('.filter_contain .filter_item').last().index();\r\n    checkEmptyFilterItem();\r\n    if(filter_index >= 1 && ($('.template_filter .select_option').length)) {\r\n        var option_clone = $('.template_filter .select_option').clone();\r\n        var parent = $('.filter_contain .filter_item').last().prepend(option_clone);\r\n        parent.find('.field_filter_option').addClass('hidden').attr('disabled', 'disabled');\r\n        parent.find('.filter_scenario_value .filter_scenario').addClass('hidden').attr('disabled', 'disabled');\r\n    }\r\n    indexParam();\r\n    return filter_index;\r\n}\r\n\r\n//fill Filter To Form\r\nfunction fillFilterToForm(data) {\r\n    if(data != void 0 && data.length) {\r\n        $(data).each(function (i, e) {\r\n            var filter_index = addFilterItem(),\r\n                filter_item = $('.filter_contain .filter_item').eq(filter_index),\r\n                option = e.option,\r\n                variable_code = e.condition,\r\n                compare = e.compare,\r\n                value = e.value,\r\n                scenario_id = e.scenario_id;\r\n\r\n            filter_item.find('select.filter_option').val(option).trigger('change');\r\n            filter_item.find('select.filter_variable').val(variable_code);\r\n\r\n            //get data follow variable after fill data for variable select\r\n            getFilterVariableData(filter_index, false);\r\n\r\n            filter_item.find('select.filter_operator').val(compare);\r\n            filter_item.find('select.filter_scenario').val(scenario_id);\r\n\r\n            if(!filter_item.find('select.filter_value_select').prop('disabled')) {\r\n                filter_item.find('select.filter_value_select').val(value);\r\n            } else {\r\n                filter_item.find('input.filter_value_text').val(value);\r\n\r\n                //if variable_code is custom code then show corresponding field\r\n                if(_variable_custom.indexOf(variable_code) >= 0) {\r\n                    switch (variable_code) {\r\n                        case 'current_time':\r\n                            setDateTypeValue(filter_index);\r\n                            break;\r\n                    }\r\n                }\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\n//get date value and fill to text type\r\nfunction getDateTypeValue(filter_index) {\r\n    var filter_item = $('.filter_contain .filter_item').eq(filter_index),\r\n        month_val   = filter_item.find('select.filter_value_minute').val(),\r\n        day_val     = filter_item.find('select.filter_value_hour').val(),\r\n        date_str    = '';\r\n\r\n    if(month_val != void 0 && day_val != void 0) {\r\n        date_str = day_val + _sperate_text + month_val;\r\n    }\r\n    filter_item.find('input.filter_value_text').val(date_str);\r\n}\r\n\r\n//set date value from text type value\r\nfunction setDateTypeValue(filter_index) {\r\n    var filter_item = $('.filter_contain .filter_item').eq(filter_index),\r\n        filter_value_text = filter_item.find('input.filter_value_text').val();\r\n\r\n    if(filter_value_text != void 0 && filter_value_text != '') {\r\n        var date_arr = filter_value_text.split(_sperate_text);\r\n        if(date_arr.length <= 2) {\r\n            filter_item.find('select.filter_value_hour').val(date_arr[0]);\r\n            filter_item.find('select.filter_value_minute').val(date_arr[1]);\r\n        }\r\n    }\r\n}\r\n//count user follow filter\r\nfunction getNumberUser() {\r\n    var url = $('.template_filter .number_user_filter_url').val(),\r\n        csrf_token  = $('.template_filter .csrf_token').val();\r\n    if (url != undefined && url != ''){\r\n        $.ajax({\r\n            url: url,\r\n            type: 'POST',\r\n            data: $('.notification_create_form').serialize(),\r\n            success: function(data) {\r\n                var message = $('.number_user p.hidden').html();\r\n                $('.number_user label').html('');\r\n                if(data != void 0){\r\n                    message = message.replace(':number', data.user_count);\r\n                    $('.number_user label').html(message);\r\n                }\r\n            },\r\n            error: function(result){\r\n\r\n            },\r\n            complete: function () {\r\n            }\r\n        });\r\n    }\r\n}\r\n\r\n"]}